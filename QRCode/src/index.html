<!DOCTYPE html> 
<html manifest="manifest.appcache"> 
  <head> 
    <meta charset="utf-8"> 
    <meta http-equiv="pragma" content="no-cache">
    <title>Camera</title>
    <link type="text/css" rel="stylesheet" href="style/camera.css"/>
    <script type="text/javascript" src="js/camera.js"></script>
	<script type="text/javascript" src="grid.js"></script>
	<script type="text/javascript" src="version.js"></script>
	<script type="text/javascript" src="detector.js"></script>
	<script type="text/javascript" src="formatinf.js"></script>
	<script type="text/javascript" src="errorlevel.js"></script>
	<script type="text/javascript" src="bitmat.js"></script>
	<script type="text/javascript" src="datablock.js"></script>
	<script type="text/javascript" src="bmparser.js"></script>
	<script type="text/javascript" src="datamask.js"></script>
	<script type="text/javascript" src="rsdecoder.js"></script>
	<script type="text/javascript" src="gf256poly.js"></script>
	<script type="text/javascript" src="gf256.js"></script>
	<script type="text/javascript" src="decoder.js"></script>
	<script type="text/javascript" src="QRCode.js"></script>
	<script type="text/javascript" src="findpat.js"></script>
	<script type="text/javascript" src="alignpat.js"></script>
	<script type="text/javascript" src="databr.js"></script>

    <script type="text/javascript">
	function handleFiles(f)
	{
		var o=[];
		for(var i =0;i<f.length;i++)
		{
		  var reader = new FileReader();

	      reader.onload = (function(theFile) {
		return function(e) {
		  qrcode.decode(e.target.result);
		};
	      })(f[i]);

	      // Read in the image file as a data URL.
	      reader.readAsDataURL(f[i]);	}
	}

    function link_highlight(str)
	{
		var ind=str.indexOf("http://");
		if(ind!=-1)
		{
			var lastind=str.lastIndexOf("\/");
			if(lastind==ind+6)
			{
				lastind=str.length;
				str=str+"/";
			}
			return (str.substring(0,ind)+"<a href=\""+str.substring(ind)+"\">"+str.substring(ind+7,lastind)+"</a>");
		}
        return str;
	}
	
	function read(a)
	{
        myhtml = '<p class="message">' + link_highlight(a) + '</p>';
        document.getElementById("panel").innerHTML=myhtml;

	}	
	
	function load()
	{
		qrcode.callback = read;
		//qrcode.decode("img.png");
	}


    function decodeQR() {

    }

    function htmlEntities(str) {
        return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    function handleFile(f) {
        alert(document.getElementById("imagefile").value);
        alert(htmlEntities(f[0].fileName));
        //myhtml = "<img src=\"" + htmlEntities(f[0]) + "\" />";

        
    }
    </script>
    
    <script type="text/javascript" src="qrlib/grid.js"></script>
    <script type="text/javascript" src="qrlib/version.js"></script>
    <script type="text/javascript" src="qrlib/detector.js"></script>
    <script type="text/javascript" src="qrlib/formatinf.js"></script>
    <script type="text/javascript" src="qrlib/errorlevel.js"></script>
    <script type="text/javascript" src="qrlib/bitmat.js"></script>
    <script type="text/javascript" src="qrlib/datablock.js"></script>
    <script type="text/javascript" src="qrlib/bmparser.js"></script>
    <script type="text/javascript" src="qrlib/datamask.js"></script>
    <script type="text/javascript" src="qrlib/rsdecoder.js"></script>
    <script type="text/javascript" src="qrlib/gf256poly.js"></script>
    <script type="text/javascript" src="qrlib/gf256.js"></script>
    <script type="text/javascript" src="qrlib/decoder.js"></script>
    <script type="text/javascript" src="qrlib/QRCode.js"></script>
    <script type="text/javascript" src="qrlib/findpat.js"></script>
    <script type="text/javascript" src="qrlib/alignpat.js"></script>
    <script type="text/javascript" src="qrlib/databr.js"></script>
  </head>
  <body onload="load()">
    <div id="panel">
    <video id="viewfinder" autoplay> </video>
    </div>
    <div id="controls">
      <a id="switch-button" name="Switch source"></a>
      <a id="capture-button" name="Capture"></a>
      <a id="gallery-button" name="Go to gallery"></a>
    </div>
      <input id = "imagefile" type="file" style='visibility: hidden;' name="img" onChange="handleFiles(this.files)" />
  </body>
</html>
